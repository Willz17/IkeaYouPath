const user_schema = require("../models/user");

/**
 * (TESTED)
 * @param {*} param0 - Name, email and password of user to register
 * @ID - generated by @randomUUID (crypto)
 * @returns
 */
const registerUser = async ({ name, email, password }) => {
  const user_obj = new user_schema({
    name: name,
    email: email,
  });
  user_obj.password = user_obj.generateHash(password);

  try {
    const user = await user_obj.save();
    return user;
  } catch (e) {
    return e;
  }
};

/**
 * (TESTED)
 * (authenticate with (email and password))
 * @param {*} param0 - Email and password of user
 * @returns - User object on sucess, error object on error.
 */
const login = async ({ email, password }) => {
  try {
    await user_schema.findOne({ email: email }, (err, user) => {
      if (!err)
        if (user.validatePassword(password)) {
          return user;
        } else {
          return { message: "User doesnt exist" };
        }
    });
  } catch (e) {
    return e;
  }
};

module.exports.registerUser = registerUser;
module.exports.login = login;
